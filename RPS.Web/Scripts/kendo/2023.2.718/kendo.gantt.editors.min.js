/**
 * Kendo UI v2023.2.718 (http://www.telerik.com/kendo-ui)
 * Copyright 2023 Progress Software Corporation and/or one of its subsidiaries or affiliates. All rights reserved.
 *
 * Kendo UI commercial licenses may be obtained at
 * http://www.telerik.com/purchase/license-agreement/kendo-ui-complete
 * If you do not own a commercial license, this file shall be governed by the trial license terms.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("kendo.data.js"),require("kendo.popup.js"),require("kendo.window.js"),require("kendo.gantt.data.js"),require("kendo.grid.js"),require("kendo.datetimepicker.js"),require("kendo.numerictextbox.js"),require("kendo.textbox.js"),require("kendo.form.js"),require("kendo.tabstrip.js")):"function"==typeof define&&define.amd?define(["kendo.data.min","kendo.popup.min","kendo.window.min","kendo.gantt.data.min","kendo.grid.min","kendo.datetimepicker.min","kendo.numerictextbox.min","kendo.textbox.min","kendo.form.min","kendo.tabstrip.min"],t):((e="undefined"!=typeof globalThis?globalThis:e||self).kendogantt=e.kendogantt||{},e.kendogantt.editors=e.kendogantt.editors||{},e.kendogantt.editors.js=t())}(this,(function(){return function(e,t){var i=window.kendo,n=i.ui,o=i.Observable,a=n.Widget,d=i.htmlEncode,r=e.extend,s="23em",l="k-gantt-delete",c="k-gantt-cancel",u="k-gantt-update",p={form:"k-popup-edit-form",editForm:"k-gantt-edit-form",formContainer:"k-edit-form-container",resourcesFormContainer:"k-resources-form-container",message:"k-popup-message",buttonsContainer:"k-edit-buttons k-actions",button:"k-button",buttonDefaults:"k-button-md k-rounded-md k-button-solid k-button-solid-base",editField:"k-edit-field",editLabel:"k-edit-label",resourcesField:"k-gantt-resources"},m=o.extend({init:function(e,t){o.fn.init.call(this),this.element=e,this.options=r(!0,{},this.options,t)},destroy:function(){this.close(),this.unbind()},close:function(){var e=this,t=function(){e.editable&&(e.container.data("kendoWindow").destroy(),e.editable=null,e.container=null),e.popup&&(e.popup.destroy(),e.popup=null)};e.editable&&e.container.is(":visible")?(e.trigger("close",{window:e.container}),e.container.data("kendoWindow").bind("deactivate",t).close()):t()},editTask:function(e,t){this.task=e,this.plannedEditors=t,this.editable=this._createPopupEditor()},fields:function(){var t,n=this.options,o=this.task,a={};return n.editable.template?e.map(o.fields,(function(e,t){return{field:t}})):(a.general=this._fieldsGeneral(),n.resources&&(a.resources=[{field:"resources"}]),n.dependencies&&(a.dependencies=this._fieldsDependencies(o)),t=r(!0,{},o.fields),Object.keys(i.data.GanttTask.fields).map((function(e){delete t[e]})),Object.keys(t).length>0&&(a.other=this._fieldsOther(t)),a)},showDialog:function(t){var n,o=p,a=this.element,r=t.model,s=this,u=e(i.format('<div class="'+o.formContainer+'" data-uid="'+r.uid+'">')).appendTo(a),m=this.options.messages;u.append(e("<p>"+t.text+"</p>")),n=e('<div class="'+o.buttonsContainer+'">'),u.append(n),n.append(e("<button class='"+l+"'>"+d(m.destroy)+"</button>").kendoButton({name:"delete",themeColor:"primary",icon:"trash",click:function(e){e.preventDefault(),f.close(),t.callback()}})),n.append(e("<button class='"+c+"'>"+d(m.cancel)+"</button>").kendoButton({name:"cancel",icon:"cancel",click:function(e){e.preventDefault(),f.close(),t.callback(!0)}})),this.popup&&this.popup.destroy();var f=this.popup=u.kendoWindow({modal:!0,autoFocus:!1,resizable:!1,draggable:!1,title:t.title,visible:!1,deactivate:function(){this.destroy(),s.trigger("close",{window:u})}}).getKendoWindow();f.center().open(),f.element.find(".k-button-solid-primary").trigger("focus")},_buildButtons:function(t){var i=this.options.messages,n=e('<div class="'+p.buttonsContainer+'">');n.appendTo(t),n.append(e("<button class='"+u+"'>"+d(i.save)+"</button>").kendoButton({name:"update",themeColor:"primary",icon:"save",click:this._onSave.bind(this)})),n.append(e("<button class='"+c+"'>"+d(i.cancel)+"</button>").kendoButton({name:"cancel",icon:"cancel",click:this._onCancel.bind(this)})),n.append(e("<span class='k-spacer'>")),!1!==this.options.editable.destroy&&n.append(e("<button class='"+l+"'>"+d(i.destroy)+"</button>").kendoButton({name:"delete",themeColor:"primary",icon:"trash",fillMode:"flat",click:this._onDelete.bind(this)}))},_buildEditTemplate:function(t,n){var o=this.options.editable.template,a=r({},i.Template,this.options.templateSettings),d="";o?("string"==typeof o&&(o=i.unescape(o)),d+=i.template(o,a)(t)):(this.renderForm=!0,d+='<div role="form" class="k-gantt-edit-tabstrip" style="min-height:28em"></div>'),e(d).appendTo(n)},_createPopupEditor:function(){var t,n=this,o=this.options.messages,a=p,d=this.task,s=e(i.format('<div {0}="{1}" class="{2} {3}">',i.attr("uid"),d.uid,a.form,a.editForm));return s.appendTo(this.element),this._buildEditTemplate(d,s),this._buildButtons(s),this.container=s.kendoWindow(r({width:554,modal:!0,resizable:!1,draggable:!0,title:o.editor.editorTitle,visible:!1,actions:["Minimize","Maximize","Close"],close:function(e){e.userTriggered&&n.trigger("cancel",{container:s,model:d})&&e.preventDefault()}},{})),t=this.renderForm?this._initForm():s.kendoEditable({model:d,clearContainer:!1,validateOnBlur:!0,target:n.options.target}).data("kendoEditable"),i.cycleForm(s),this.trigger("edit",{container:s,model:d})?n.trigger("cancel",{container:s,model:d}):s.data("kendoWindow").center().open(),t},_fieldsDependencies:function(e){return{nameDdlDs:this.options.target.dataSource.data().filter((function(t){return t.id!==e.id})).map((function(e){return{text:e.title,value:e.id}})),typeDs:[{value:0,text:"Finish-Finish"},{value:1,text:"Finish-Start"},{value:2,text:"Start-Finish"},{value:3,text:"Start-Start"}]}},_fieldsGeneral:function(){var e,t,n,o=this,a=this.options,d=a.target.dataSource,s=a.messages.editor,l=this.task,c=l.fields,u=this.plannedEditors?s.actualStart:s.start,p=this.plannedEditors?s.actualEnd:s.end,m=[{field:"title",title:s.title,colSpan:4}];return this.plannedEditors&&(m.push({field:"plannedStart",title:s.plannedStart,colSpan:2,editor:"DateTimePicker",validation:c.plannedStart.validation,editorOptions:{componentType:"modern"}}),m.push({field:"plannedEnd",title:s.plannedEnd,colSpan:2,editor:"DateTimePicker",validation:c.plannedEnd.validation,editorOptions:{componentType:"modern"}})),e=d.data(),(t=d.taskAllChildren(l)).push(l),n=e.filter((function(e){return!t.some((function(t){return t.id===e.id}))})),m.push({field:"start",title:u,colSpan:2,editor:"DateTimePicker",validation:c.start.validation,editorOptions:{componentType:"modern"}}),m.push({field:"end",title:p,colSpan:2,editor:"DateTimePicker",validation:c.start.validation,editorOptions:{componentType:"modern"}}),m.push({field:"percentComplete",title:s.percentComplete,format:"p0",colSpan:1,hint:s.percentCompleteHint}),m.push({field:"parentId",title:s.parent,colSpan:4,editor:"DropDownList",editorOptions:{optionLabel:s.parentOptionLabel,filter:"contains",dataSource:n,enable:n.length>0,dataValueField:"id",dataTextField:"title",valuePrimitive:!0,template:function(e){var t=e.title,n=e.start,o=e.end;return"<span>"+t+" "+i.toString(n,"d")+"-"+i.toString(o,"d")+"</span>"}}}),m=m.map((function(e){return e=r(!0,{label:e.title},e),!l.editable||l.editable(e.field)?e:r(!0,e,{editor:o._readonlyEditor.bind(o)})}))},_fieldsOther:function(e){var t=this,i=this.task;return e=Object.keys(e).map((function(n){var o=e[n];return o=r(!0,{field:n,label:o.title},o),!i.editable||i.editable(o.field)?o:r(!0,o,{editor:t._readonlyEditor.bind(t)})}))},_gridOptions:function(t,i,n,o){var a,d=this.options.messages;return this.dependencyData||(this.dependencyData={}),{dataSource:{data:this.dependencyData[i]=this.options.target.dependencies.view().filter((function(e){return e[n]===o})),schema:{model:{fields:(a={id:{from:"id"}},a[i]={from:i,validation:{required:{message:d.editor.name+" is required"}}},a.type={from:"type",validation:{required:!0},defaultValue:1},a)}}},columns:[{selectable:!0,width:50},{field:i,title:d.editor.name,values:t.nameDdlDs},{field:"type",title:d.editor.dependencyType,values:t.typeDs,width:"9em"}],toolbar:[{name:"create",text:d.editor.addNew},{name:"remove",icon:"minus",text:d.editor.remove,click:function(t){var i=t.target.closest(".k-grid").getKendoGrid(),n=i.dataSource,o=i.select(),a=[];o&&o.length>0&&(o.each((function(t,n){a.push(i.dataItem(e(n)))})),a.map((function(e){n.remove(e)})))}}],editable:!0,sortable:!0,navigatable:!0,height:s,edit:function(){var t=e("[name=predecessorId], [name=successorId]");t.length&&t.data("kendoDropDownList").setOptions({filter:"contains"})}}},_initForm:function(){var t=this,i=t.task,n=t.container,o=t.options.resources,a=i.get(o.field),d=t.fields(),r=t._tabStripSource(d,a);return n.find(".k-gantt-edit-tabstrip").kendoTabStrip({dataTextField:"name",dataContentField:"content",dataSource:r,value:t.options.messages.editor.general,select:function(t){var i=t.sender,n=e(i.contentElement(i.select().index())),o=n.find(".k-grid").data("kendoGrid"),a=n.find(".k-form").data("kendoForm");(o&&o.editable&&o.editable.validatable&&!o.editable.validatable.validate()||a&&!a.validator.validate())&&t.preventDefault()}}),t._initGeneral(d.general,i),a&&(t.resourceEditor=o.editor(n.find(".k-gantt-resources"),i)),d.dependencies&&(n.find(".k-gantt-predecessors").kendoGrid(t._gridOptions(d.dependencies,"predecessorId","successorId",i.id)),n.find(".k-gantt-successors").kendoGrid(t._gridOptions(d.dependencies,"successorId","predecessorId",i.id))),d.other&&t._initOther(d.other,i),t.form.editable},_initGeneral:function(e,t){this.form=this.container.find(".k-gantt-form-default").kendoForm({layout:"grid",grid:{cols:4,gutter:{rows:0,cols:8}},items:e,formData:t,buttonsTemplate:function(){return""},validatable:{validateOnBlur:!0}}).data("kendoForm")},_initOther:function(e,t){this.container.find(".k-gantt-form-other").kendoForm({items:e,formData:t,buttonsTemplate:function(){return""},validatable:{validateOnBlur:!0}})},_readonlyEditor:function(e,t){var n=t.field,o="",a=this.options.target.dataSource;null!==t.model.get(n)&&((o=t.model.get(n))instanceof Date?o=i.toString(o,"g"):"percentComplete"===n?o=i.toString(o,t.format):"parentId"===n&&(o=a.get(o).title)),e.append("<span>"+o+"</span>")},_onCancel:function(){this.trigger("cancel",{container:this.container,model:this.task})},_onDelete:function(){this.trigger("remove",{container:this.container,model:this.task})},_onSave:function(){var t,i,n,o,a=this.task,d=[],r={},s=this.container,l=s.find(".k-gantt-predecessors").getKendoGrid(),c=s.find(".k-gantt-successors").getKendoGrid(),u={},p=[],m=[];if(l){if(n=this.dependencyData.successorId.concat(this.dependencyData.predecessorId),o=l.dataSource.view().toJSON().concat(c.dataSource.view().toJSON()),l&&l.editable&&l.editable.validatable&&!l.editable.validatable.validate()||c&&c.editable&&c.editable.validatable&&!c.editable.validatable.validate())return;o.map((function(e){i=n.find((function(t){return t.id===e.id})),i&&(i.dirty&&m.push(e),o=o.filter((function(t){return t.id!==e.id})),n=n.filter((function(t){return t.id!==e.id})))})),o.map((function(e){e.successorId?(e.predecessorId||(e.predecessorId=a.get("id")),p.push(e)):e.predecessorId&&(e.successorId||(e.successorId=a.get("id")),p.push(e))})),(p.length>0||n.length>0||m.length>0)&&(u.updateDependencies={destroyed:n,created:p,updated:m})}if(Object.values(this.fields()).map((function(e){Array.isArray(e)&&d.push.apply(d,e)})),!this.resourceEditor||this.resourceEditor.updateModel()){for(var f=0,h=d.length;f<h;f++)r[t=d[f].field]=a.get(t);this.trigger("save",e.extend({},u,{container:s,model:a,updateInfo:r}))}},_tabStripSource:function(e,t){var i=this.options.messages.editor,n=e.dependencies,o=[{name:i.general,content:"<div class='k-gantt-form-default'></div>"}];return t&&o.push({name:i.resources,content:"<div class='k-gantt-resources'></div>"}),n&&(o.push({name:i.predecessors,content:"<div class='k-gantt-predecessors'></div>"}),o.push({name:i.successors,content:"<div class='k-gantt-successors'></div>"})),e.other&&o.push({name:i.other,content:"<div class='k-gantt-form-other'></div>"}),o}}),f=a.extend({init:function(e,t){a.fn.init.call(this,e,t),this.wrapper=this.element,this.model=this.options.model,this.resourcesField=this.options.resourcesField,this._resourceGrid()},destroy:function(){this.grid=null,a.fn.destroy.call(this),this.element=this.wrapper=null},updateModel:function(){var e,i,n=[],o=this.grid,a=o.dataSource.data(),d=o.editable;if(d&&d.validatable&&!d.validatable.validate())return!1;for(var r=0,s=a.length;r<s;r++)i=(e=a[r]).get("value"),e.id!==t&&null!==i&&i>0&&n.push(a[r]);return this.model[this.resourcesField]=n,!0},_resourceGrid:function(){var e=this,n=this.options.messages,o=e.options,a=this.wrapper,d=o.resources;e.grid=new i.ui.Grid(a,{columns:[{selectable:!0,width:50},{field:"id",title:n.resourcesHeader,values:d},{field:"value",title:n.unitsHeader,template:function(e){var t=e.format||"p0",n=null!==e.value?e.value:"";return t?i.toString(n,t):n},width:120}],height:s,sortable:!0,editable:!0,filterable:!0,navigatable:!0,toolbar:[{name:"create",text:n.addNew},{name:"remove",icon:"minus",text:n.remove,click:function(){var t=e.grid,i=t.dataSource,n=t.selectedKeyNames();n&&n.length>0&&n.map((function(e){i.remove(i.get(e))}))}}],dataSource:{data:this.model.resources,schema:{model:{id:"id",fields:{id:{from:"id",defaultValue:t,validation:{required:{message:n.resourcesHeader+" is required"}}},value:{from:"value",type:"number",defaultValue:1,validation:this.options.unitsValidation},format:{from:"format",type:"string"}}}}},edit:function(e){var t=e.container.find("select").data("kendoDropDownList"),i=e.model.id,n=o.model.resources.map((function(e){return e.id})).filter((function(e){return e!==i})).map((function(e){return{field:"value",operator:"neq",value:e}}));t&&(t.dataSource.filter({logic:"and",filters:n}),t.setOptions({filter:"contains"}))}})}});i.gantt={PopupEditor:m,ResourceEditor:f}}(window.kendo.jQuery),kendo}));
//# sourceMappingURL=kendo.gantt.editors.min.js.map
